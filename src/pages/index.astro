---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import Footer from "../components/Footer.astro";
import Sidebar from "../components/Sidebar.astro";
import ArticleCard from "../components/ArticleCard.astro";
import { getCollection } from "astro:content";
import { calculateReadingTime } from "../utils/readingTime";

const allPosts = await getCollection("posts");
const featuredPost = allPosts.find((post) => post.data.featured);
const regularPosts = allPosts
	.filter((post) => !post.data.featured)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const formatDate = (date: Date) => {
	return date.toLocaleDateString("en-US", {
		year: "numeric",
		month: "short",
		day: "numeric",
	});
};
---

<Layout title="DimonBlog | Tech, Code & Life">
	<Header />
	<Hero />

	<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 w-full">
		<div class="flex flex-col lg:flex-row gap-12">
			<!-- Main Content -->
			<div class="lg:w-2/3">
				<div class="flex items-center justify-between mb-8">
					<h2
						class="text-2xl font-bold text-slate-900 dark:text-white border-l-4 border-primary pl-3"
					>
						Featured Articles
					</h2>
					<a
						class="text-sm text-primary hover:text-cyan-300 font-medium flex items-center"
						href="/archive"
					>
						View All <span class="material-icons text-sm ml-1"
							>arrow_forward</span
						>
					</a>
				</div>

				<!-- Featured Post -->
				{
					featuredPost && (
						<ArticleCard
							featured={true}
							title={featuredPost.data.title}
							description={featuredPost.data.description}
							image={featuredPost.data.image}
							category={featuredPost.data.category}
							author={featuredPost.data.author}
							authorImage={featuredPost.data.authorImage}
							date={formatDate(featuredPost.data.pubDate)}
							readTime={
								featuredPost.data.readTime ||
								calculateReadingTime(featuredPost.body)
							}
							slug={featuredPost.slug}
						/>
					)
				}

				<!-- Regular Posts Grid -->
				<div class="grid md:grid-cols-2 gap-6">
					{
						regularPosts.map((post) => (
							<ArticleCard
								title={post.data.title}
								description={post.data.description}
								image={post.data.image}
								category={post.data.category}
								author={post.data.author}
								date={formatDate(post.data.pubDate)}
								readTime={post.data.readTime || calculateReadingTime(post.body)}
								slug={post.slug}
							/>
						))
					}
				</div>

				<div class="mt-12 text-center">
					<a
						href="/archive"
						class="inline-block px-6 py-2 rounded-full border border-slate-300 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:border-primary hover:text-primary dark:hover:border-primary dark:hover:text-primary transition-all text-sm font-medium"
					>
						View All Articles
					</a>
				</div>
			</div>

			<!-- Sidebar -->
			<Sidebar />
		</div>
	</main>

	<Footer />
</Layout>
